!function(a){a.fn.slideDown=function(a){this.show();var b=this.height();this.css({height:0}),this.animate({height:b},a)},a.fn.slideUp=function(a){var b=this,c=this.height();this.css({height:c}),this.animate({height:0},a,"",function(){b.css({display:"none",height:""})})}}(Zepto);var YEAST={dme:.36669970267592,type_fermentation:null,batch_volume:null,original_gravity:null,optimal_pitching_rate:null,yeast_cells_needed:null,initial_cell_count:null,viability:null,viable_cell_count:null,round:function(a,b){var c=Math.pow(10,b),d=a*c;return Math.round(d)/c},format_density:function(a){return parseInt(a.replace(".",""))-1e3},pitching_rate:function(a,b){b=YEAST.format_density(b),"lager"==a?result=2*Math.pow(10,-8)*Math.pow(b,4)-4*Math.pow(10,-6)*Math.pow(b,3)-5*Math.pow(10,-5)*Math.pow(b,2)+.3818*b-.0482:(result=-1*Math.pow(10,-8)*Math.pow(b,4)+3*Math.pow(10,-6)*Math.pow(b,3)-4e-4*Math.pow(b,2)+.1999*b-.0921,"hybrid"==a&&(result*=1.3)),YEAST.optimal_pitching_rate=result.toPrecision(3)},yeast_cells_need_calc:function(a,b){YEAST.yeast_cells_needed=Math.ceil(a*b)},growth_calc:function(a,b){result=b*a/100,YEAST.viable_cell_count=Math.ceil(result)}};Zepto(function(a){a("legend").on("click",function(b){var c=a(this),d=a(this).next();return 0==c.hasClass("closed")?(c.addClass("closed"),d.slideUp(250)):(c.removeClass("closed"),d.slideDown(250)),!1}),a("#batch_volume, #type_fermentation, #original_gravity").on("change",function(b){YEAST.type_fermentation=a("#type_fermentation").val(),YEAST.batch_volume=a("#batch_volume").val(),YEAST.original_gravity=a("#original_gravity").val(),YEAST.pitching_rate(YEAST.type_fermentation,YEAST.original_gravity),YEAST.yeast_cells_need_calc(YEAST.batch_volume,YEAST.optimal_pitching_rate),a("#optimal_pitching_rate").val(YEAST.optimal_pitching_rate),a("#yeast_cells_needed").val(YEAST.yeast_cells_needed),a(".trigger").trigger("change")}),a("#initial_cell_count, #viability").on("change",function(b){YEAST.initial_cell_count=a("#initial_cell_count").val(),YEAST.viability=a("#viability").val(),YEAST.growth_calc(YEAST.initial_cell_count,YEAST.viability),a("#viable_cell_count").val(YEAST.viable_cell_count),a(".trigger").trigger("change")}),a(".trigger").on("change",function(b){var c=a(this).parents("fieldset").data("step"),d=YEAST.format_density(a("#starter_gravity_"+c).val()),e=a("#starter_volume_"+c).val(),f=d/YEAST.dme,g=YEAST.viable_cell_count;if(c>1)var g=a("#total_cells_at_finish_"+(c-1)).val();var h=g/(f*e);growth_factor=h<1.4?1.4:h>=1.4&&h<3.5?7/3-2/3*h:0,new_cells=growth_factor*f*e,a("#new_cells_created_"+c).val(Math.round(new_cells)),a("#growth_factor_"+c).val((new_cells/g).toPrecision(3));var i=Math.round(Number(new_cells)+Number(g));a("#total_cells_at_finish_"+c).val(i),i>YEAST.yeast_cells_needed?a("#total_cells_at_finish_"+c).removeClass("nok").addClass("ok"):a("#total_cells_at_finish_"+c).removeClass("ok").addClass("nok")}),a("#batch_volume, #initial_cell_count, #starter_volume_1").trigger("change")});